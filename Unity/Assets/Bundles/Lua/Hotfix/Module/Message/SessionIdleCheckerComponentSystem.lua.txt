-- Generated by CSharp.lua Compiler
local System = System
local ET = ET
local ET
System.import(function (out)
  ET = out.ET
end)
System.namespace("ET", function (namespace)
  namespace.class("SessionIdleCheckerComponentAwakeSystem", function (namespace)
    local Awake
    Awake = function (this, self, checkInteral)
      self.RepeatedTimer = ET.TimerComponent.Instance:NewRepeatedTimer(checkInteral, System.fn(self, ET.SessionIdleCheckerComponentSystem.Check))
    end
    return {
      base = function (out)
        return {
          out.ET.AwakeSystem_2(out.ET.SessionIdleCheckerComponent, System.Int32)
        }
      end,
      Awake = Awake,
      __metadata__ = function (out)
        return {
          class = { 0x6, out.ET.ObjectSystemAttribute() }
        }
      end
    }
  end)

  namespace.class("SessionIdleCheckerComponentDestroySystem", function (namespace)
    local Destroy
    Destroy = function (this, self)
      self.RepeatedTimer = ET.TimerComponent.Instance:Remove(self.RepeatedTimer)
    end
    return {
      base = function (out)
        return {
          out.ET.DestroySystem_1(out.ET.SessionIdleCheckerComponent)
        }
      end,
      Destroy = Destroy,
      __metadata__ = function (out)
        return {
          class = { 0x6, out.ET.ObjectSystemAttribute() }
        }
      end
    }
  end)

  namespace.class("SessionIdleCheckerComponentSystem", function (namespace)
    local Check
    Check = function (self)
      local session = self:GetParent(ET.Session)
      local timeNow = ET.TimeHelper.ClientNow()

      if timeNow - session.LastRecvTime < 30000 --[[30 * 1000]] and timeNow - session.LastSendTime < 30000 --[[30 * 1000]] then
        return
      end

      ET.Log.Info("session timeout: " .. session.Id .. " " .. timeNow .. " " .. session.LastRecvTime .. " " .. session.LastSendTime .. " " .. timeNow - session.LastRecvTime .. " " .. timeNow - session.LastSendTime)
      session.Error = 110311 --[[ErrorCode.ERR_SessionSendOrRecvTimeout]]

      session:Dispose()
    end
    return {
      Check = Check
    }
  end)
end)
